<!DOCTYPE html>
<html>
<head>
  <title>Enviar Eventos</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Enviar Eventos</h1>
    
    <div class="control-panel">
      <button id="send-event-btn">Enviar Evento</button>
      <p>Contador: <span id="counter">0</span></p>
    </div>
    
    <div class="status">
      <p>Estado: <span id="status">Listo</span></p>
      <p>Último envío: <span id="last-sent">Ninguno aún</span></p>
    </div>
    
    <a href="events.html" class="view-events-link">Ver Eventos Registrados</a>
  </div>

  <script>
    let counter = 0;
    const btn = document.getElementById('send-event-btn');
    const counterDisplay = document.getElementById('counter');
    const statusDisplay = document.getElementById('status');
    const lastSentDisplay = document.getElementById('last-sent');
  
    btn.addEventListener('click', async () => {
      counter++;
      counterDisplay.textContent = counter;
      statusDisplay.textContent = "Enviando...";
      
      try {
        const response = await fetch('/api/evento', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            boton: "boton_web",
            accion: "click",
            contador: counter,  // Asegúrate de enviar el contador
            origen: "interfaz_web"
          })
        });
        
        const data = await response.json();
        statusDisplay.textContent = "Éxito!";
        lastSentDisplay.textContent = new Date().toLocaleTimeString();
        
      } catch (error) {
        statusDisplay.textContent = "Error al enviar";
        console.error('Error:', error);
      }
    });
  </script>
</body>
</html>